# Tidy Data, Visualization and Distributions {#day3}

We will be using functions and data from the
tidyverse today, so lets load it.
It is good practice to have all library loading
and data import steps at the beginning of your

```{r}
library(tidyverse)
```

## Recap of day 2

### Questions

- What is the `tidyverse`?
- What are the most important `dplyr` verbs and their function?
- Transfer: What do the following lines do?

```{r, eval=FALSE}
starwars %>%
  group_by(homeworld) %>% 
  mutate(mass = mass / max(mass, na.rm = TRUE))
```

- What is a p-value?
- What is the difference between
  _binomially_ and _hypergeometrically_ distributed data?

### Answers

We use the `starwars` dataset to demonstrate the answers.

```{r}
# starwars
```

`select` 

```{r}
# demonstrate select and selct helpers
```

`filter` 

```{r}
# demonstrate filter
```

`mutate`

```{r}
# demonstrate mutate
```

`arrange`

```{r}
# demonstrate arrange
```

`summamrise`

```{r}
# demonstrate summarise
```

`group_by` and `summarise`

```{r}
# mean mass per homeplanet
```

Running the code demonstrates...

```{r, eval=FALSE}
starwars %>% 
  group_by(homeworld) %>% 
  mutate(mass = mass / max(mass, na.rm = TRUE) )
```

... so this code...

For the definition of p-values, check out chapter \@ref(p-values).

Hypergeometric distribution

```{r}
x <- rhyper(10000, m = 50, n =  50, k =  80)
hist(x)
```

Binomial distribution

```{r}
x <- rbinom(n = 10000, size = 10, prob = 0.5)
hist(x, breaks = 0:10)
```

## Visualization with ggplot2

### The Grammar of Graphics

```{r}
starwars %>% 
  filter(mass < 500) %>% 
  ggplot(aes(height, mass, color = gender, label = name)) +
  geom_point() 
```


## Visualization is Key

### Anscombes Quartet

And a note on _Tidy Data_ and the `tidyr` package.

```{r}
# show anscombe
```

Anscombes quartet is special because the datasets 1 to 4
look quite different but have the same x-mean, y-mean
and simple linear regression!

```{r}
# demonstrate mean, sd, corr
```

A cool trick from functional programming:
**Higher order functions**, e.g. the `map`-family.

For all the datatypes (e.g. _integer_ or _double_)
there is a special version of map named `map_<datatype>`,
which will always return this type
and is thus safer to program with.

```{r}
# map mean
```

```{r}
# map_dbl
```

### Excursion Tidy Data

Tidy Data means:

> Every row is an observation, every column is a feature

But this is not always straightforward.

> "Happy families are all alike;
  every unhappy family is unhappy in its own way."
  $-$ Leo Tolstoy

> Tidy datasets are all alike,
  but every messy dataset is messy in its own way."
  $-$ Hadley Wickham

#### Anscombe

The `anscombe` dataset actually hides a feature
in its column names! The `tidyr` package helps us,
to extract it into it's own column.

```{r tidy-data, fig.cap="Following three rules makes a dataset tidy: variables are in columns, observations are in rows, and values are in cells. (Source: R4DS, Hadley Wickham)", echo=FALSE}
knitr::include_graphics("img/tidy-1.png")
```

```{r}
anscombe_long <- anscombe %>%
 pivot_longer(everything(),
   names_pattern = "(.)(.)",
   names_to = c(".value", "set")
 )
```

Now our dataset plays better with the rest of the tidyverse,
especially ggplot:

```{r}
# plot anscombe sets
```

```{r}
# summarise sets
```

#### Plate Reader Example

```{r plate-reader-img, echo=FALSE, fig.cap="(Quelle: https://www.stellarscientific.com/accuris-smartreader-96-microplate-absorbance-plate-reader/"}
knitr::include_graphics("img/plate-reader.jpg")
```


```{r}
# read atpase data
```

Clean the data, make it tidy

```{r}
# pivot longer
```

Visualize data

```{r}
# line plot
```

Normalize data

```{r}
# normalize by max absorbtion
```

Visualize data again

```{r}
# lineplot
```

### Summary Statistics

#### Standard Deviation

```{r}
# explain mean, SD, SEM based on random numbers from normal distribution
```

$$sd = \sqrt{\frac{\sum_{i=0}^{n}{(x_i-\bar x)^2}}{(n-1)} }$$

Why n-1?

```{r}
x = c(1,1,3,1)
mean(x)
sd(x)
```

$$var = \sigma^2$$

#### Standard Error of the Mean

Often called SEM or SE.

$$SEM=\sigma / \sqrt{n}$$

## Distributions

```{r}
# generate 1000 random normally distributed numbers
```


```{r}
# hist
```


```{r}
# sd
```


```{r}
# hist with lines for SD
# explain percentages within the lines
```


```{r}
# sem
```

### From Distributions to Quantiles

```{r}
# curve dnorm
```


```{r}
# curve pnorm
```

```{r}
# curve qnorm
```

Quantiles!

#### Quantile-Quantile Plots

> Is my data normally distributed?

```{r}
# qqnorm
# qqline
```

## The Datasaurus Dozen

You can find the research paper [here](https://www.autodeskresearch.com/publications/samestats)
[@matejka2017a].

```{r}
# install.packages("datasauRus")
```

```{r}
# get dino boxplot data
```

```{r}
# tidy it
```

Boxplots!

```{r}
# make boxplot
```


```{r}
# summarise data by set with SD, SEM, mean
```

```{r}
# create barplot with errorbars, SD or SEM
```

```{r}
# finally show the point plot 
```

```{r}
# and the jitter plot
```

Friends don't let friends make barplots!

```{r}
# histograms
```

```{r}
# density plot
```

## Exercises

### Inclusion Bodies

You can get the dataset from my Github Repository:

```{r, eval=FALSE}
read_csv("https://raw.githubusercontent.com/jannikbuhr/dataIntro19/master/data/03_inclusion_bodies.csv") %>% 
  write_csv("data/03_inclusion_bodies.csv")
```

Natürlich kannst du auch direkt die Daten über den Link laden,
aber so hast du sie für schlechte Zeiten (sprich: keine Internetverbindung)
gleich gespeichert.

_Disclaimer_: Die Daten stammen aus dem letztjährigen Kurs
und sind echte Daten,
aber ich lüge euch bei der Bedeutung ein
ganz klein wenig an um den biologischen Hintergrund
schneller erklären und sie ohne Probleme veröffentlichen
zu können.

```{r}
# Erklärung Inclusion Bodies
```

- If you want to impress me, do all the exercises
  in a Rmarkdown document, add your conclusions and thoughts
  along with the data analysis process and structure it
  with meaningful headlines using `#`.
- Read the csv-file `data/03_inclusion_bodies.csv`.
- Make it tidy
- Visualize the data with ggplot as:
  - Jittered point plot
  - Boxplot
  - Two overlayed histograms
    (_Hint_: use `position = "identity"`
    so that R doesn't stack the bars)
  - Zwei overlayed density plots
    (_Hint_: use the parameter `alpha`
    to make both of them visble at the same time)
  - A Barplot with errorbars, _hints_:
    - Create a summary first
    - Use `geom_col`, **not** `geom_bar`
  - BONUS: Make the plots pretty with ggplot theme options

### Solutions



