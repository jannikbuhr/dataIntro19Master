# Correlation and Regression {#day5}

## Side note: What is the main goal of this course?

I can not teach you every single function,
every data structure, every statistical analysis.

Rather, I want to give you a high level overview
of what is possible. And I want to teach you
how you can view your data problems in a way
that enables you to solve them.

We want to go from seeing the numbers

![](img/matrix_A06UFEx8jxEwU.gif)

To seeing the structure behind it

![](img/matrix+pill_SCt3Miv6ugvSg.gif)

## Correlation and Regression

The data for today are available from their
[original source](https://figshare.com/articles/Storks_and_human_babies_data/839299/1)
or [my github repository](https://github.com/jannikbuhr/dataIntro19Master/tree/master/data).

It's about storks! And because according to folk wisdom storks bring
the babies, we get the number of stork pairs per country and
the birthrate in $10^3$ babies per year.
Additionally, we get the number of people per country and
the area in $km^2$.

```{r}
# load tidyverse
# load stork data
```

This data shows a clear relationship between the number
of stork pairs and the birthrate in a country [@matthews2000].

```{r}
# show storks vs birth rate with ggplot, points
```

The data looks better on a logarithmic scale,
this diminishes the effect of outliers in our plot.

```{r}
# ggplot with dual log scale and annotation_logticks, theme classic
```

```{r}
# talk about log tranformation in general, biological data, tests
```


### Correlation

$$cor(X,Y)=\frac{cov(X,Y)}{\sigma_X \sigma_Y}=\frac{E\left[(X-\mu_X)(Y-\mu_Y)\right]}{\sigma_X \sigma_Y}$$

```{r}
# explain correlation
# show cor of Storks and Birth
```

```{r}
# do cor of log transformed data
```

```{r}
# do cor.test
# explain range of correlation coefficient
# explain R and R^2
```

```{r}
# cor with default pearson and spearman
```

```{r, echo=FALSE, fig.cap='Source: XKCD, https://www.xkcd.com/552/'}
knitr::include_graphics("img/correlation.png")
```

### Regression

A related concept is linear regression.

```{r}
# create lm model of babies ~ storks
# show summary
```

The _R squared_ value, also called the coefficient of determination,
in fact refers to the same R as Pearsons R (the correlation coefficient).

```{r}
# ggplot of Storks and Birth
# with log scale
# and geom_smooth for lm
```

```{r}
# create the loglinear lm
```

But what happens when our data does not follow
a linear model?

## Non-Linear Regression

### Michaelis-Menten Kinetics

As an example we will use the common Michaelis-Menten kinetics.
There is a dataset for enzyme reaction rates included in R.

```{r}
# load Puromycin, as_tibble
```


```{r}
# get only treated
```

```{r puro_treat_plts, fig.show='hold', out.width="50%"}
# base R plot
# ggplot
```


```{r}
# define calculateMM
# (Vm * conc) / (K + conc)
```

```{r}
# calculate y  <- x , x > 0, x < 1
# plot x y
```

```{r}
# plot function in ggplot with starting conditions
# show args as well as ~ notation
```


```{r}
# run nls of rate ~ function on data
```

```{r}
# show str of model summary
```

```{r}
# get coefficients
```

```{r}
# coef
```


```{r}
# extract estimated coefficients
```

```{r}
# use coeffictionts to plot function in ggplot
```

Side note: There is also _self starting models_

```{r}
# e.g. SSmicmen (conc, Vm, K)
```

You can use any model created with a modelling
function such as `nls` or `lm` with
the `predict` function to predict new values
for new data:

```{r}
# show the predict function
```

### Many Models

The superpower of tibbles!

```{r}
# nest puromycin by state
```

```{r}
# show how to acces content of nested data
```

```{r}
# add a model column with nls as lambda function
```


```{r}
# ggplot of puromycin with geom_smooth method nls and method.args
# remember se = FALSE
```

```{r}
# add coef column with map coef
# unnest coef wider
```


## Exercises

### With the Datasaurus Dozen Data Sets

```{r}
datasauRus::datasaurus_dozen %>% head()
```

- Visualize all data sets in one ggplot,
  - Hint: use`facet_wrap`
- Add linear regression lines
  - Hint: use `geom_smooth`
- Do the fit manually on the dataset and extract the coefficients
  - Hints: See above, nest the data first, create the model column, etc.
  
### Example Data Analysis

With your data!

### Solutions




